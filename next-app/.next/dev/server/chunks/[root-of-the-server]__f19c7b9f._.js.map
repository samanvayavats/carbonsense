{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 106, "column": 0}, "map": {"version":3,"sources":["file:///D:/projects/carbonsense/lib/aichat.ts"],"sourcesContent":["const chatWithAi = async (message: string) => {\n  try {\n    const response = await fetch(\n      \"https://openrouter.ai/api/v1/chat/completions\",\n      {\n        method: \"POST\",\n        headers: {\n          Authorization: `Bearer ${process.env.OPENROUTER_API_KEY}`,\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          model: \"tngtech/deepseek-r1t2-chimera:free\",\n          messages: [\n            {\n              role: \"system\",\n              content: `\n                    You are a carbon emission estimation assistant named CarbonSense.\n                    Your task is to calculate approximate carbon emissions for user activities.\n\n                    The user will send natural language inputs like:\n                    - \"I drove 10 km today\"\n                    - \"I used AC for 3 hours\"\n                    - \"I took a flight for 800 km\"\n\n                    You must always respond an object \n                    {\n                      \"chat\": \"Friendly explanation in one short sentence about their carbon emission\",\n                      \"carbonEmission\": number (approximation in kilograms of CO2)\n                    }\n\n                    If unsure, make your best reasonable estimate based on common averages (for example, 10 km drive â‰ˆ 2.3 kg CO2). Do not include any text outside the JSON.\n            `,\n            },\n            {\n              role: \"user\",\n              content: message,\n            },\n          ],\n        }),\n      },\n    );\n\n    if (!response.ok) {\n      throw new Error(\"Failed to fetch AI response\");\n    }\n\n    const data = await response.json();\n\n    const rawResponse = data?.choices?.[0]?.message?.content || \"{}\";\n\n    return rawResponse;\n  } catch (error: any) {\n    console.error(\"Error in chatWithAi:\", error.message);\n    return {\n      chat: \"Error occurred while getting AI response.\",\n      carbonEmission: 0,\n    };\n  }\n};\n\nexport default chatWithAi;\n"],"names":[],"mappings":";;;;AAAA,MAAM,aAAa,OAAO;IACxB,IAAI;QACF,MAAM,WAAW,MAAM,MACrB,iDACA;YACE,QAAQ;YACR,SAAS;gBACP,eAAe,CAAC,OAAO,EAAE,QAAQ,GAAG,CAAC,kBAAkB,EAAE;gBACzD,gBAAgB;YAClB;YACA,MAAM,KAAK,SAAS,CAAC;gBACnB,OAAO;gBACP,UAAU;oBACR;wBACE,MAAM;wBACN,SAAS,CAAC;;;;;;;;;;;;;;;;YAgBZ,CAAC;oBACD;oBACA;wBACE,MAAM;wBACN,SAAS;oBACX;iBACD;YACH;QACF;QAGF,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,IAAI,MAAM;QAClB;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAEhC,MAAM,cAAc,MAAM,SAAS,CAAC,EAAE,EAAE,SAAS,WAAW;QAE5D,OAAO;IACT,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,wBAAwB,MAAM,OAAO;QACnD,OAAO;YACL,MAAM;YACN,gBAAgB;QAClB;IACF;AACF;uCAEe","debugId":null}},
    {"offset": {"line": 173, "column": 0}, "map": {"version":3,"sources":["file:///D:/projects/carbonsense/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\n\nconst prismaClientSingleton = () => {\n  return new PrismaClient();\n};\n\ntype PrismaClientSingleton = ReturnType<typeof prismaClientSingleton>;\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClientSingleton | undefined;\n};\n\nconst prisma = globalForPrisma.prisma ?? prismaClientSingleton();\n\nexport default prisma;\n\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = prisma;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,wBAAwB;IAC5B,OAAO,IAAI,6IAAY;AACzB;AAIA,MAAM,kBAAkB;AAIxB,MAAM,SAAS,gBAAgB,MAAM,IAAI;uCAE1B;AAEf,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 196, "column": 0}, "map": {"version":3,"sources":["file:///D:/projects/carbonsense/lib/auth.ts"],"sourcesContent":["import CredentialsProvider from \"next-auth/providers/credentials\";\nimport prisma from \"@/lib/prisma\";\nimport bcrypt from \"bcrypt\";\nimport { SessionStrategy } from \"next-auth\";\n\nexport const authOptions = {\n  session: {\n    strategy: \"jwt\" as SessionStrategy,\n  },\n\n  providers: [\n    CredentialsProvider({\n      name: \"Credentials\",\n      credentials: {\n        username: { label: \"username\", type: \"text\" },\n        password: { label: \"password\", type: \"password\" },\n      },\n\n      async authorize(credentials) {\n        if (!credentials?.username || !credentials?.password) return null;\n\n        const user = await prisma.user.findUnique({\n          where: { name: credentials.username },\n        });\n\n        if (!user) return null;\n\n        const valid = await bcrypt.compare(credentials.password, user.password);\n        if (!valid) return null;\n\n        return {\n          id: String(user.id),\n          name: user.name,\n          email: user.email,\n        };\n      },\n    }),\n  ],\n\n  callbacks: {\n    async jwt({ token, user }: { token: any; user?: any }) {\n      if (user) {\n        token.id = user.id;\n        token.name = user.name;\n        token.email = user.email;\n      }\n      return token;\n    },\n\n    async session({ session, token }: { session: any; token: any }) {\n      session.user = {\n        id: token.id,\n        name: token.name,\n        email: token.email,\n      };\n      return session;\n    },\n  },\n\n  secret: process.env.NEXTAUTH_SECRET,\n};\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAGO,MAAM,cAAc;IACzB,SAAS;QACP,UAAU;IACZ;IAEA,WAAW;QACT,IAAA,qKAAmB,EAAC;YAClB,MAAM;YACN,aAAa;gBACX,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAO;gBAC5C,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YAClD;YAEA,MAAM,WAAU,WAAW;gBACzB,IAAI,CAAC,aAAa,YAAY,CAAC,aAAa,UAAU,OAAO;gBAE7D,MAAM,OAAO,MAAM,0HAAM,CAAC,IAAI,CAAC,UAAU,CAAC;oBACxC,OAAO;wBAAE,MAAM,YAAY,QAAQ;oBAAC;gBACtC;gBAEA,IAAI,CAAC,MAAM,OAAO;gBAElB,MAAM,QAAQ,MAAM,gHAAM,CAAC,OAAO,CAAC,YAAY,QAAQ,EAAE,KAAK,QAAQ;gBACtE,IAAI,CAAC,OAAO,OAAO;gBAEnB,OAAO;oBACL,IAAI,OAAO,KAAK,EAAE;oBAClB,MAAM,KAAK,IAAI;oBACf,OAAO,KAAK,KAAK;gBACnB;YACF;QACF;KACD;IAED,WAAW;QACT,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAA8B;YACnD,IAAI,MAAM;gBACR,MAAM,EAAE,GAAG,KAAK,EAAE;gBAClB,MAAM,IAAI,GAAG,KAAK,IAAI;gBACtB,MAAM,KAAK,GAAG,KAAK,KAAK;YAC1B;YACA,OAAO;QACT;QAEA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAgC;YAC5D,QAAQ,IAAI,GAAG;gBACb,IAAI,MAAM,EAAE;gBACZ,MAAM,MAAM,IAAI;gBAChB,OAAO,MAAM,KAAK;YACpB;YACA,OAAO;QACT;IACF;IAEA,QAAQ,QAAQ,GAAG,CAAC,eAAe;AACrC","debugId":null}},
    {"offset": {"line": 265, "column": 0}, "map": {"version":3,"sources":["file:///D:/projects/carbonsense/app/api/user/chat-with-ai/route.ts"],"sourcesContent":["import { getServerSession } from \"next-auth\";\nimport { NextRequest, NextResponse } from \"next/server\";\nimport chatWithAi from \"@/lib/aichat\";\nimport { authOptions } from \"@/lib/auth\";\nimport prisma from \"@/lib/prisma\";\n\nexport async function GET() {\n  try {\n    const session = await getServerSession(authOptions);\n\n    // checking for the session\n    if (!session) {\n      return NextResponse.json(\n        { message: \"Not authenticated\" },\n        { status: 401 },\n      );\n    }\n\n    const user = await prisma.aiChats.findMany({\n      where: {\n        userId: Number(session?.user?.id)\n      }\n    })\n\n    return NextResponse.json({\n      message: \"all the chats fetched !!!\",\n      chats: user\n    })\n  } catch (error) {\n\n    console.log(error)\n    return NextResponse.json({\n      message: \"something went wrong at the time of fetching the chats \"\n    }\n      , { status: 500 }\n    )\n  }\n\n}\n\n// chat with the ai and updating the carbonEmission\nexport async function POST(req: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n\n    // checking for the session\n    if (!session) {\n      return NextResponse.json(\n        { message: \"Not authenticated\" },\n        { status: 401 },\n      );\n    }\n\n    const { chatFromUser } = await req.json();\n    if (!chatFromUser) {\n      return NextResponse.json(\n        { message: \"Input is required\" },\n        { status: 400 },\n      );\n    }\n\n    // making the call to the ai\n    const aiResponse = await chatWithAi(chatFromUser);\n\n    // making the string more simple for parsing\n    const response = aiResponse\n      .replace(/```json/gi, \"\")\n      .replace(/```/g, \"\")\n      .trim();\n\n    try {\n      // parsing the reponse from the ai\n      const parseResponse = JSON.parse(response);\n\n      // storing the chat of ai and the user in the db\n      const storeReponseInTheDb = await prisma.aiChats.create({\n        data: {\n          userId: Number(session?.user?.id),\n          chatFromUser: chatFromUser,\n          aiResponse: parseResponse?.chat,\n        },\n      });\n\n      // finding the user from the oldCarbonEmission\n      const user = await prisma.user.findUnique({\n        where: {\n          id: Number(session?.user?.id),\n        },\n      });\n\n      // calculating the new carbonEmission\n      const oldCarbonEmission = Number(user?.carbonEmission);\n\n      const carbonEmission = Number(parseResponse?.carbonEmission) || 0;\n\n      const NewCarbonEmission = oldCarbonEmission + carbonEmission;\n\n      // updating the new carbonEmission\n      const updateTheCarbonEmission = await prisma.user.update({\n        where: {\n          id: Number(session?.user?.id),\n        },\n        data: {\n          carbonEmission: JSON.stringify(NewCarbonEmission),\n        },\n      });\n\n      if (!updateTheCarbonEmission) {\n        return NextResponse.json(\n          {\n            message: \"something went wrong on updating the carbonEmission \",\n          },\n          { status: 500 },\n        );\n      }\n\n      if (!storeReponseInTheDb) {\n        return NextResponse.json(\n          {\n            message: \"something went wrong while saving the chats \",\n          },\n          { status: 500 },\n        );\n      }\n\n      return NextResponse.json(\n        {\n          message: \"Reposne form ai\",\n          response: parseResponse,\n        },\n        { status: 200 },\n      );\n    } catch (error) {\n      return NextResponse.json(\n        {\n          message: \"something went wrong !!! please send the message again\",\n          response: {\n            chat: \"please message again\",\n            carbonEmission: 0,\n          },\n        },\n        {\n          status: 408,\n        },\n      );\n    }\n  } catch (err) {\n    console.error(err);\n    return NextResponse.json(\n      { message: \"Server error  for chating with the ai \" },\n      { status: 500 },\n    );\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}