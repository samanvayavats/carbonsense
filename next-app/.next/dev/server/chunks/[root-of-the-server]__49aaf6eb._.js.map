{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///D:/projects/carbonsense/next-app/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\n\nconst prismaClientSingleton = () => {\n  return new PrismaClient();\n};\n\ntype PrismaClientSingleton = ReturnType<typeof prismaClientSingleton>;\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClientSingleton | undefined;\n};\n\nconst prisma = globalForPrisma.prisma ?? prismaClientSingleton();\n\nexport default prisma;\n\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = prisma;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,wBAAwB;IAC5B,OAAO,IAAI,sMAAY;AACzB;AAIA,MAAM,kBAAkB;AAIxB,MAAM,SAAS,gBAAgB,MAAM,IAAI;uCAE1B;AAEf,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 57, "column": 0}, "map": {"version":3,"sources":["file:///D:/projects/carbonsense/next-app/lib/auth.ts"],"sourcesContent":["import CredentialsProvider from \"next-auth/providers/credentials\";\nimport prisma from \"@/lib/prisma\";\nimport bcrypt from \"bcrypt\";\nimport { SessionStrategy } from \"next-auth\";\n\nexport const authOptions = {\n  session: {\n    strategy: \"jwt\" as SessionStrategy,\n  },\n\n  providers: [\n    CredentialsProvider({\n      name: \"Credentials\",\n      credentials: {\n        username: { label: \"username\", type: \"text\" },\n        password: { label: \"password\", type: \"password\" },\n      },\n\n      async authorize(credentials) {\n        if (!credentials?.username || !credentials?.password) return null;\n\n        const user = await prisma.user.findUnique({\n          where: { name: credentials.username },\n        });\n\n        if (!user) return null;\n\n        const valid = await bcrypt.compare(credentials.password, user.password);\n        if (!valid) return null;\n\n        return {\n          id: String(user.id),\n          name: user.name,\n          email: user.email,\n        };\n      },\n    }),\n  ],\n\n  callbacks: {\n    async jwt({ token, user }: { token: any; user?: any }) {\n      if (user) {\n        token.id = user.id;\n        token.name = user.name;\n        token.email = user.email;\n      }\n      return token;\n    },\n\n    async session({ session, token }: { session: any; token: any }) {\n      session.user = {\n        id: token.id,\n        name: token.name,\n        email: token.email,\n      };\n      return session;\n    },\n  },\n\n  secret: process.env.NEXTAUTH_SECRET,\n};\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAGO,MAAM,cAAc;IACzB,SAAS;QACP,UAAU;IACZ;IAEA,WAAW;QACT,IAAA,qKAAmB,EAAC;YAClB,MAAM;YACN,aAAa;gBACX,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAO;gBAC5C,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YAClD;YAEA,MAAM,WAAU,WAAW;gBACzB,IAAI,CAAC,aAAa,YAAY,CAAC,aAAa,UAAU,OAAO;gBAE7D,MAAM,OAAO,MAAM,0HAAM,CAAC,IAAI,CAAC,UAAU,CAAC;oBACxC,OAAO;wBAAE,MAAM,YAAY,QAAQ;oBAAC;gBACtC;gBAEA,IAAI,CAAC,MAAM,OAAO;gBAElB,MAAM,QAAQ,MAAM,6JAAM,CAAC,OAAO,CAAC,YAAY,QAAQ,EAAE,KAAK,QAAQ;gBACtE,IAAI,CAAC,OAAO,OAAO;gBAEnB,OAAO;oBACL,IAAI,OAAO,KAAK,EAAE;oBAClB,MAAM,KAAK,IAAI;oBACf,OAAO,KAAK,KAAK;gBACnB;YACF;QACF;KACD;IAED,WAAW;QACT,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAA8B;YACnD,IAAI,MAAM;gBACR,MAAM,EAAE,GAAG,KAAK,EAAE;gBAClB,MAAM,IAAI,GAAG,KAAK,IAAI;gBACtB,MAAM,KAAK,GAAG,KAAK,KAAK;YAC1B;YACA,OAAO;QACT;QAEA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAgC;YAC5D,QAAQ,IAAI,GAAG;gBACb,IAAI,MAAM,EAAE;gBACZ,MAAM,MAAM,IAAI;gBAChB,OAAO,MAAM,KAAK;YACpB;YACA,OAAO;QACT;IACF;IAEA,QAAQ,QAAQ,GAAG,CAAC,eAAe;AACrC"}},
    {"offset": {"line": 174, "column": 0}, "map": {"version":3,"sources":["file:///D:/projects/carbonsense/next-app/lib/cloudinary.ts"],"sourcesContent":["// myModule.js\nimport { v2 as cloudinary } from \"cloudinary\";\n\ncloudinary.config({\n  cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\n  api_key: process.env.CLOUDINARY_API_KEY,\n  api_secret: process.env.CLOUDINARY_API_SECRET,\n});\n\nexport default cloudinary;\n"],"names":[],"mappings":";;;;AAAA,cAAc;AACd;;AAEA,gJAAU,CAAC,MAAM,CAAC;IAChB,YAAY,QAAQ,GAAG,CAAC,qBAAqB;IAC7C,SAAS,QAAQ,GAAG,CAAC,kBAAkB;IACvC,YAAY,QAAQ,GAAG,CAAC,qBAAqB;AAC/C;uCAEe,gJAAU"}},
    {"offset": {"line": 197, "column": 0}, "map": {"version":3,"sources":["file:///D:/projects/carbonsense/next-app/lib/uploadoncloudinary.ts"],"sourcesContent":["import cloudinary from \"./cloudinary\";\nimport streamifier from \"streamifier\";\nimport { UploadApiResponse } from \"cloudinary\";\n\nexport const uploadStreamToCloudinary = (\n  fileBuffer: Buffer,\n): Promise<UploadApiResponse> => {\n  return new Promise((resolve, reject) => {\n    let stream = cloudinary.uploader.upload_stream(\n      { resource_type: \"auto\" },\n      (error, result) => {\n        if (result) {\n          resolve(result);\n        } else {\n          reject(error);\n        }\n      },\n    );\n    streamifier.createReadStream(fileBuffer).pipe(stream);\n  });\n};\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAGO,MAAM,2BAA2B,CACtC;IAEA,OAAO,IAAI,QAAQ,CAAC,SAAS;QAC3B,IAAI,SAAS,8HAAU,CAAC,QAAQ,CAAC,aAAa,CAC5C;YAAE,eAAe;QAAO,GACxB,CAAC,OAAO;YACN,IAAI,QAAQ;gBACV,QAAQ;YACV,OAAO;gBACL,OAAO;YACT;QACF;QAEF,wJAAW,CAAC,gBAAgB,CAAC,YAAY,IAAI,CAAC;IAChD;AACF"}},
    {"offset": {"line": 253, "column": 0}, "map": {"version":3,"sources":["file:///D:/projects/carbonsense/next-app/app/api/community/create-community/route.ts"],"sourcesContent":["import { authOptions } from \"@/lib/auth\";\nimport prisma from \"@/lib/prisma\";\nimport { uploadStreamToCloudinary } from \"@/lib/uploadoncloudinary\";\nimport { getServerSession } from \"next-auth\";\nimport { NextRequest, NextResponse } from \"next/server\";\n\nexport async function POST(req: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n\n    if (!session) {\n      return NextResponse.json(\n        { message: \"Not authenticated\" },\n        { status: 401 },\n      );\n    }\n\n    const body = await req.formData();\n\n    const communityName = body.get(\"communityName\") as string;\n    const communityAvatar = body.get(\"communityAvatar\");\n\n    if (!communityAvatar || !communityName) {\n      return NextResponse.json(\n        {\n          message: \"all the fields are required\",\n        },\n        { status: 401 },\n      );\n    }\n\n    const communityAvatarBuffer = Buffer.from(\n      await (communityAvatar as Blob).arrayBuffer(),\n    );\n\n    const cloudinaryReponse = await uploadStreamToCloudinary(\n      communityAvatarBuffer,\n    );\n\n    if (!cloudinaryReponse) {\n      return NextResponse.json(\n        {\n          message: \"not able to upload the communityAvatar right now\",\n        },\n        { status: 500 },\n      );\n    }\n\n    const community = await prisma.communities.create({\n      data: {\n        communityOwnerName: session?.user?.name,\n        communityOwnerId: Number(session?.user?.id),\n        communityName: communityName,\n        communityAvatar: cloudinaryReponse?.secure_url,\n        CommunityAvatarPublicId: cloudinaryReponse?.public_id,\n      },\n    });\n\n    if (!community) {\n      return NextResponse.json(\n        {\n          message: \"community not created please try agian later\",\n        },\n        { status: 500 },\n      );\n    }\n\n    const participant = await prisma.participants.create({\n      data: {\n        participantName: session?.user?.name,\n        communityName: communityName,\n        communityId: Number(community?.id),\n        participantsUserId: Number(session?.user?.id),\n      },\n    });\n\n    if (!participant) {\n      return NextResponse.json(\n        {\n          message:\n            \"community not created please try agian later or participation failed\",\n        },\n        { status: 500 },\n      );\n    }\n\n    return NextResponse.json(\n      {\n        message: \" community has been created successfully\",\n        community: community,\n        participant: participant,\n      },\n      { status: 200 },\n    );\n  } catch (error) {\n    console.log(\"the error at the time of creating the community is : \", error);\n\n    return NextResponse.json(\n      {\n        message: \"community not created please try agian later\",\n      },\n      { status: 500 },\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;;;;;;AAEO,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,UAAU,MAAM,IAAA,2JAAgB,EAAC,4HAAW;QAElD,IAAI,CAAC,SAAS;YACZ,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;YAAoB,GAC/B;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,OAAO,MAAM,IAAI,QAAQ;QAE/B,MAAM,gBAAgB,KAAK,GAAG,CAAC;QAC/B,MAAM,kBAAkB,KAAK,GAAG,CAAC;QAEjC,IAAI,CAAC,mBAAmB,CAAC,eAAe;YACtC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBACE,SAAS;YACX,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,wBAAwB,OAAO,IAAI,CACvC,MAAM,AAAC,gBAAyB,WAAW;QAG7C,MAAM,oBAAoB,MAAM,IAAA,uJAAwB,EACtD;QAGF,IAAI,CAAC,mBAAmB;YACtB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBACE,SAAS;YACX,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,YAAY,MAAM,0HAAM,CAAC,WAAW,CAAC,MAAM,CAAC;YAChD,MAAM;gBACJ,oBAAoB,SAAS,MAAM;gBACnC,kBAAkB,OAAO,SAAS,MAAM;gBACxC,eAAe;gBACf,iBAAiB,mBAAmB;gBACpC,yBAAyB,mBAAmB;YAC9C;QACF;QAEA,IAAI,CAAC,WAAW;YACd,OAAO,gJAAY,CAAC,IAAI,CACtB;gBACE,SAAS;YACX,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,cAAc,MAAM,0HAAM,CAAC,YAAY,CAAC,MAAM,CAAC;YACnD,MAAM;gBACJ,iBAAiB,SAAS,MAAM;gBAChC,eAAe;gBACf,aAAa,OAAO,WAAW;gBAC/B,oBAAoB,OAAO,SAAS,MAAM;YAC5C;QACF;QAEA,IAAI,CAAC,aAAa;YAChB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBACE,SACE;YACJ,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,WAAW;YACX,aAAa;QACf,GACA;YAAE,QAAQ;QAAI;IAElB,EAAE,OAAO,OAAO;QACd,QAAQ,GAAG,CAAC,yDAAyD;QAErE,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,SAAS;QACX,GACA;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}