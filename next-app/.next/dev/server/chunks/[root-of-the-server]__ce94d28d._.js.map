{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/projects/carbonsense/lib/aichat.ts"],"sourcesContent":["const chatWithAi = async (message: string) => {\n  try {\n    const response = await fetch(\n      \"https://openrouter.ai/api/v1/chat/completions\",\n      {\n        method: \"POST\",\n        headers: {\n          Authorization: `Bearer ${process.env.OPENROUTER_API_KEY}`,\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          model: \"tngtech/deepseek-r1t2-chimera:free\",\n          messages: [\n            {\n              role: \"system\",\n              content: `\n                    You are a carbon emission estimation assistant named CarbonSense.\n                    Your task is to calculate approximate carbon emissions for user activities.\n\n                    The user will send natural language inputs like:\n                    - \"I drove 10 km today\"\n                    - \"I used AC for 3 hours\"\n                    - \"I took a flight for 800 km\"\n\n                    You must always respond **only in JSON** format:\n                    {\n                      \"chat\": \"Friendly explanation in one short sentence about their carbon emission\",\n                      \"carbonEmission\": number (approximation in kilograms of CO2)\n                    }\n\n                    If unsure, make your best reasonable estimate based on common averages (for example, 10 km drive â‰ˆ 2.3 kg CO2). Do not include any text outside the JSON.\n            `,\n            },\n            {\n              role: \"user\",\n              content: message,\n            },\n          ],\n        }),\n      },\n    );\n\n    if (!response.ok) {\n      throw new Error(\"Failed to fetch AI response\");\n    }\n\n    const data = await response.json();\n\n    const rawResponse = data?.choices?.[0]?.message?.content || \"{}\";\n\n  \n    return rawResponse;\n  } catch (error: any) {\n    console.error(\"Error in chatWithAi:\", error.message);\n    return {\n      chat: \"Error occurred while getting AI response.\",\n      carbonEmission: 0,\n    };\n  }\n};\n\nexport default chatWithAi;\n"],"names":[],"mappings":";;;;AAAA,MAAM,aAAa,OAAO;IACxB,IAAI;QACF,MAAM,WAAW,MAAM,MACrB,iDACA;YACE,QAAQ;YACR,SAAS;gBACP,eAAe,CAAC,OAAO,EAAE,QAAQ,GAAG,CAAC,kBAAkB,EAAE;gBACzD,gBAAgB;YAClB;YACA,MAAM,KAAK,SAAS,CAAC;gBACnB,OAAO;gBACP,UAAU;oBACR;wBACE,MAAM;wBACN,SAAS,CAAC;;;;;;;;;;;;;;;;YAgBZ,CAAC;oBACD;oBACA;wBACE,MAAM;wBACN,SAAS;oBACX;iBACD;YACH;QACF;QAGF,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,IAAI,MAAM;QAClB;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAEhC,MAAM,cAAc,MAAM,SAAS,CAAC,EAAE,EAAE,SAAS,WAAW;QAG5D,OAAO;IACT,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,wBAAwB,MAAM,OAAO;QACnD,OAAO;YACL,MAAM;YACN,gBAAgB;QAClB;IACF;AACF;uCAEe","debugId":null}},
    {"offset": {"line": 173, "column": 0}, "map": {"version":3,"sources":["file:///D:/projects/carbonsense/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\n\nconst prismaClientSingleton = () => {\n  return new PrismaClient();\n};\n\ntype PrismaClientSingleton = ReturnType<typeof prismaClientSingleton>;\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClientSingleton | undefined;\n};\n\nconst prisma = globalForPrisma.prisma ?? prismaClientSingleton();\n\nexport default prisma;\n\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = prisma;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,wBAAwB;IAC5B,OAAO,IAAI,6IAAY;AACzB;AAIA,MAAM,kBAAkB;AAIxB,MAAM,SAAS,gBAAgB,MAAM,IAAI;uCAE1B;AAEf,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 196, "column": 0}, "map": {"version":3,"sources":["file:///D:/projects/carbonsense/lib/auth.ts"],"sourcesContent":["import CredentialsProvider from \"next-auth/providers/credentials\";\nimport prisma from \"@/lib/prisma\";\nimport bcrypt from \"bcrypt\";\nimport { SessionStrategy } from \"next-auth\";\n\nexport const authOptions = {\n  providers: [\n    CredentialsProvider({\n      name: \"username\",\n      credentials: {\n        username: { label: \"username\", type: \"text\", placeholder: \"username\" },\n        password: { label: \"password\", type: \"text\", placeholder: \"password\" },\n      },\n      async authorize(credentials: any, req) {\n        console.log(credentials);\n        const username = credentials?.username;\n        const password = credentials?.password;\n\n        const user = await prisma.user.findUnique({\n          where: {\n            name: username,\n          },\n        });\n\n        const isPasswordCorrect = bcrypt.compareSync(\n          password,\n          user?.password || \"\",\n        );\n\n        if (!isPasswordCorrect || !user) {\n          return null;\n        }\n\n        return {\n          id: String(user.id),\n          name: user?.name,\n          email: user?.email,\n        };\n\n        return null;\n      },\n    }),\n  ],\n  callbacks: {\n     async jwt({ token, user }: { token: any; user?: { id?: string; name?: string; email?: string } }) {\n    if (user) {\n      token.id = user.id;\n      token.name = user.name;\n      token.email = user.email;\n    }\n    return token;\n  },\n    async session({ session, token }: { session: any; token: any }) {\n    if (token) {\n      session.user = session.user || {};\n      session.user.id = token.id;\n      session.user.name = token.name;\n      session.user.email = token.email;\n    }\n    return session;\n  },\n  },\n\n  session: {\n    strategy: \"jwt\" as SessionStrategy,\n  },\n  secret: process.env.NEXTAUTH_SECRET,\n};\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAGO,MAAM,cAAc;IACzB,WAAW;QACT,IAAA,qKAAmB,EAAC;YAClB,MAAM;YACN,aAAa;gBACX,UAAU;oBAAE,OAAO;oBAAY,MAAM;oBAAQ,aAAa;gBAAW;gBACrE,UAAU;oBAAE,OAAO;oBAAY,MAAM;oBAAQ,aAAa;gBAAW;YACvE;YACA,MAAM,WAAU,WAAgB,EAAE,GAAG;gBACnC,QAAQ,GAAG,CAAC;gBACZ,MAAM,WAAW,aAAa;gBAC9B,MAAM,WAAW,aAAa;gBAE9B,MAAM,OAAO,MAAM,0HAAM,CAAC,IAAI,CAAC,UAAU,CAAC;oBACxC,OAAO;wBACL,MAAM;oBACR;gBACF;gBAEA,MAAM,oBAAoB,gHAAM,CAAC,WAAW,CAC1C,UACA,MAAM,YAAY;gBAGpB,IAAI,CAAC,qBAAqB,CAAC,MAAM;oBAC/B,OAAO;gBACT;gBAEA,OAAO;oBACL,IAAI,OAAO,KAAK,EAAE;oBAClB,MAAM,MAAM;oBACZ,OAAO,MAAM;gBACf;;;YAGF;QACF;KACD;IACD,WAAW;QACR,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAyE;YACjG,IAAI,MAAM;gBACR,MAAM,EAAE,GAAG,KAAK,EAAE;gBAClB,MAAM,IAAI,GAAG,KAAK,IAAI;gBACtB,MAAM,KAAK,GAAG,KAAK,KAAK;YAC1B;YACA,OAAO;QACT;QACE,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAgC;YAC9D,IAAI,OAAO;gBACT,QAAQ,IAAI,GAAG,QAAQ,IAAI,IAAI,CAAC;gBAChC,QAAQ,IAAI,CAAC,EAAE,GAAG,MAAM,EAAE;gBAC1B,QAAQ,IAAI,CAAC,IAAI,GAAG,MAAM,IAAI;gBAC9B,QAAQ,IAAI,CAAC,KAAK,GAAG,MAAM,KAAK;YAClC;YACA,OAAO;QACT;IACA;IAEA,SAAS;QACP,UAAU;IACZ;IACA,QAAQ,QAAQ,GAAG,CAAC,eAAe;AACrC","debugId":null}},
    {"offset": {"line": 273, "column": 0}, "map": {"version":3,"sources":["file:///D:/projects/carbonsense/app/api/user/chat-with-ai/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport chatWithAi from \"@/lib/aichat\";\nimport { getServerSession } from \"next-auth\";\nimport { authOptions } from '@/lib/auth'\n\nexport async function POST(req: NextRequest, res: NextResponse) {\n\n    try {\n        const session = await getServerSession({ req:NextRequest, res:NextResponse.next(), ...authOptions });\n        // safe access with optional chaining\n        const name = session?.data?.user?.name\n        const email = session?.data?.user?.email\n        const id = session?.data?.user?.id\n        console.log('the console from the session hook ', session)\n        const { chatFromUser } = await req.json();\n\n        if (!chatFromUser) {\n            return NextResponse.json(\n                {\n                    message: \"input is required for chat\",\n                },\n                { status: 401 },\n            );\n        }\n\n        const response = await chatWithAi(chatFromUser);\n\n        \n        try {\n            const paresedReponse = JSON.parse(response)\n            return NextResponse.json(\n                {\n                    message: \"data fetched\",\n                    reposnse: paresedReponse\n                },\n                { status: 200 },\n            );\n        } catch (error) {\n\n            return NextResponse.json({\n                message :\"Something went wrong !!! please ask the question again\",\n                response : {\n                    chat :\"please ask the question again \",\n                    \"carbonEmission\": 0\n                }\n            })\n        }\n\n\n\n\n    } catch (error) {\n        console.log(\"the error at time of communicating with the ai is \", error);\n        return NextResponse.json(\n            {\n                message: \"Something went wrong at the time of fetching the data \",\n            },\n            { status: 500 },\n        );\n    }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEO,eAAe,KAAK,GAAgB,EAAE,GAAiB;IAE1D,IAAI;QACA,MAAM,UAAU,MAAM,IAAA,2JAAgB,EAAC;YAAE,KAAI,+IAAW;YAAE,KAAI,gJAAY,CAAC,IAAI;YAAI,GAAG,4HAAW;QAAC;QAClG,qCAAqC;QACrC,MAAM,OAAO,SAAS,MAAM,MAAM;QAClC,MAAM,QAAQ,SAAS,MAAM,MAAM;QACnC,MAAM,KAAK,SAAS,MAAM,MAAM;QAChC,QAAQ,GAAG,CAAC,sCAAsC;QAClD,MAAM,EAAE,YAAY,EAAE,GAAG,MAAM,IAAI,IAAI;QAEvC,IAAI,CAAC,cAAc;YACf,OAAO,gJAAY,CAAC,IAAI,CACpB;gBACI,SAAS;YACb,GACA;gBAAE,QAAQ;YAAI;QAEtB;QAEA,MAAM,WAAW,MAAM,IAAA,0HAAU,EAAC;QAGlC,IAAI;YACA,MAAM,iBAAiB,KAAK,KAAK,CAAC;YAClC,OAAO,gJAAY,CAAC,IAAI,CACpB;gBACI,SAAS;gBACT,UAAU;YACd,GACA;gBAAE,QAAQ;YAAI;QAEtB,EAAE,OAAO,OAAO;YAEZ,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACrB,SAAS;gBACT,UAAW;oBACP,MAAM;oBACN,kBAAkB;gBACtB;YACJ;QACJ;IAKJ,EAAE,OAAO,OAAO;QACZ,QAAQ,GAAG,CAAC,sDAAsD;QAClE,OAAO,gJAAY,CAAC,IAAI,CACpB;YACI,SAAS;QACb,GACA;YAAE,QAAQ;QAAI;IAEtB;AACJ","debugId":null}}]
}